<!DOCTYPE html>
<html>
<head>
    <title>Fresh Vegetables Online</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: green; }
        input { padding: 8px; margin: 5px 0; width: 250px; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        .form-section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Fresh Vegetables Store</h1>

    <!-- Initial Auth Section -->
    <div id="authSection">
        <button onclick="showRegister()">Register</button>
        <button onclick="showLogin()">Login</button>
    </div>

    <!-- Register Form -->
    <div id="registerForm" class="form-section" style="display:none;">
        <h3>Register</h3>
        <input type="text" id="newUser" placeholder="Username"><br>
        <input type="password" id="newPass" placeholder="Password"><br>
        <button onclick="registerUser()">Submit</button>
    </div>

    <!-- Login Form -->
    <div id="loginForm" class="form-section" style="display:none;">
        <h3>Login</h3>
        <input type="text" id="loginUser" placeholder="Username"><br>
        <input type="password" id="loginPass" placeholder="Password"><br>
        <button onclick="loginUser()">Submit</button>
    </div>

    <!-- Checkout Form -->
    <div id="checkoutSection" class="form-section" style="display:none;">
        <h3>Enter Delivery Details</h3>
        <input type="text" id="custName" placeholder="Full Name"><br>
        <input type="text" id="custAddress" placeholder="Address"><br>
        <input type="text" id="custPhone" placeholder="Phone Number"><br>
        <button onclick="placeOrder()">Place Order</button>
    </div>

    <script>
        const API_URL = "http://localhost:5000/api"; // backend URL

        function showRegister() {
            document.getElementById('registerForm').style.display = "block";
            document.getElementById('loginForm').style.display = "none";
        }

        function showLogin() {
            document.getElementById('loginForm').style.display = "block";
            document.getElementById('registerForm').style.display = "none";
        }

        async function registerUser() {
            let username = document.getElementById('newUser').value.trim();
            let password = document.getElementById('newPass').value.trim();

            if (!username || !password) {
                alert("Please enter both username and password");
                return;
            }

            try {
                const res = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();
                alert(data.message);
                if (res.ok) showLogin();
            } catch (err) {
                console.error(err);
                alert("Error registering user");
            }
        }

        async function loginUser() {
            let username = document.getElementById('loginUser').value.trim();
            let password = document.getElementById('loginPass').value.trim();

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();

                if (res.ok && data.token) {
                    localStorage.setItem('token', data.token);
                    alert("Login successful!");
                    document.getElementById('authSection').style.display = "none";
                    document.getElementById('loginForm').style.display = "none";
                    document.getElementById('checkoutSection').style.display = "block";
                } else {
                    alert(data.message);
                }
            } catch (err) {
                console.error(err);
                alert("Error logging in");
            }
        }

        async function placeOrder() {
            const name = document.getElementById('custName').value.trim();
            const address = document.getElementById('custAddress').value.trim();
            const phone = document.getElementById('custPhone').value.trim();
            const token = localStorage.getItem('token');

            if (!name || !address || !phone) {
                alert("Please fill all fields");
                return;
            }
            if (!token) {
                alert("Please login first!");
                return;
            }

            try {
                const res = await fetch(`${API_URL}/order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token
                    },
                    body: JSON.stringify({ name, address, phone })
                });
                const data = await res.json();
                alert(data.message);
                if (res.ok) {
                    document.getElementById('custName').value = "";
                    document.getElementById('custAddress').value = "";
                    document.getElementById('custPhone').value = "";
                }
            } catch (err) {
                console.error(err);
                alert("Error placing order");
            }
        }
    </script>
</body>
</html>
